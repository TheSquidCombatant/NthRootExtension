using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json;
using System.IO;

namespace System.Numerics.Extensions.Tests
{
    [TestClass]
    public class NthRootExtensionTests
    {
        [TestMethod]
        [DataRow(125, 4000, 4000)]
        [DataRow(250, 2000, 2000)]
        [DataRow(500, 1000, 1000)]
        [DataRow(1000, 500, 500)]
        [DataRow(2000, 250, 250)]
        [DataRow(4000, 125, 125)]
        public void NthRootRandomTest(int iterationsCount, int maxBasement, int maxExponent)
        {
            var random = new Random(DateTime.Now.Millisecond);

            for (int i = 0; i < iterationsCount; ++i)
            {
                var basement = (BigInteger)random.Next(1, maxBasement);
                var exponent = (int)random.Next(1, maxExponent);
                var source = BigInteger.Pow(basement, exponent);
                var actualBasement = source.NthRoot(exponent, true);
                var actualResult = (actualBasement != null);
                var message = $"basement={basement}, exponent={exponent}, source={source}";
                Assert.AreEqual(true, actualResult, message);
                Assert.AreEqual(basement.ToString(), actualBasement?.ToString() ?? "", message);
            }
        }

        [TestMethod]
        [DataRow("16", "2", "256")]
        [DataRow("11", "3", "1331")]
        [DataRow("13", "5", "371293")]
        [DataRow("4", "4", "256")]
        [DataRow(null, "2", "257")]
        [DataRow("3", "3", "27")]
        [DataRow("99", "5", "9509900499")]
        [DataRow("123", "12", "11991163848716906297072721")]
        [DataRow(null, "12", "11991163848716906297072720")]
        [DataRow(null, "12", "11991163848716906297072722")]
        [DataRow(null, "11", "11991163848716906297072721")]
        [DataRow(null, "13", "11991163848716906297072721")]
        [DataRow("18", "43", "947802215300518093524546391156037533862547778103672832")]
        [DataRow("345233453123545", "313", "268737953041144302071728869180266888347506463586171372099628337027598864884468196507120965997020540921275961138826655513454528087632977021441312520927624736334331565003216262069272131050142823989562468658618426293041682715593985525622224681894305253682551526480627755780646753021740525299239054376466829829311041031710461999814168664642957392625984476051906805343546737119775369134986356498464197515926438967100034132190875651774606587276225718890208552885829102017803058749669030343261489669274890233593043554186610956186337675459643033491825855929680530611391194087194679439382206827494472478824728600438813248083619651306555466384737467678605183088876616562138361681801166451292004674657144868491901353246359743275761712096431472965455067175509844553410897814492941052663540390940539047915726839529357699433954358047040418465694061373976486367149665622877408771719145244161026135420523405248881551182340127114608436915522074403755149866986129590114293999587260100685557572042365961095586391000491971277549117727678244209339826440931640909043635218815202381024112528852997159527433408737564131342711628802110059956510302644430440736538489575288112768580472140023915753777047597888492934496707389754119576169931522165656865343938400339245053004019015157065410259688205433969587566580602176075289178538393001257174381187007001606694881943547314178903593867163982307284239913189797356439757619456862806589017870503923859349934400513338186339270941672967328268221388226819592789718687000219253824871201643153471405373797967742891970411394341913838870959777387421650712958957383779116339208836071557140375907463869787861777597173915961958579258199908065154903673023753878282940059417163521861649477052615195490451682107760984517012956355338248051582283920765068329345553577961397430286623218892590269352216650969193134017508653316467865619337301297086595297728005836747848581568574301548538251759411021118965389703715989166167893410495289973800782674211857528595909307990362210526586779548666276657249227333849756828604354399087010508104571260107684347279031568962826053557027508681632602793430592115102474865778549412737538409779600115101462510726110123204322043682556590516821248403942828359006168007210950555457710785738152535182099671578260357359795731043596354207012543184192712413376492980045813535803752557913363607510171242171707752665251053267120245982963955137464738484089567767553128420322596751974897214646384220522467623910486197904134801649614354564461386957769458731608080355133695266139124109240826059466653585583998006962194146300509357209489925728950680759599436839792770189541247283242419100178566562746105308837412426429459365160370605768504792493003200556315842681859082508717903834353192270082992369462536593465243966986776963148550889097718472480963537858814069455094436607860883080543237613023749444015108720910673325545336979014309245152597713626987454609253247169777071431880577801084865426311851765112287575217559251667467439560778592464422573212841717492609504158108995607449806418794436834590904975701329509626616018976304678188208126996978225278015757958281751615640129649503181673739784498338653493823942073894972753551061262094493316611042159222065525030326486372232956180474657106091299562275759407528397956600712868518383282808711218195237507280356576774420585270614847579110885597243185365017667661760316774320691456234476533908847907586885328231064187440089567042845889652898614990026319676940012731080764014262451822932801807101300262113173350712728185462942924595361292885625916327501781449666282248655466744799236915732765422009187075462346521426841994741558141085859272687746923788234048251613148692374471122893520391244844216067791087688406348664154046835500658235623366939509201213000177525233804753898570044476613203367882168567892108918081772789488026721462562691191998595551363210387563993861588335727955139201839931161859145895558529919074015129130398457073741612566181574897066741995316573285951948887529074139360349458827911759131391853578019998376162339632435930280996431436952284504647865930722441759634493528356222206614385198967061045890831986760115608046716170059420891275668001469671779527475955460205889131742625096749500018373717879868777550683657638643438907905465149608678374298911553625866132286534288602484691975654722347577218946030301719173484318789866604379486433599589274145757079205397293019004493829596123176638798399741118954639154275190512904575165598168355055478890512985363540314909133687104348325385052606312134708334867050504139914936948770919633577847207561717368662357330322265625")]
        [DataRow("100", "247", "100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")]
        [DataRow("158", "82", "1949310985336625194115105900266396720219489878799285747616540839569561190984719088353558087149532845054708811040938652118267391695531419212956570868022547020596404157933247805784064")]
        [DataRow("126", "172", "18354128173788541469652558419013147990810629046818431550210402180880600157198206525485777024761520293661247069166151242842576381573602687214234822691406865066507950602244124707835245388546595475764775866194181994087684387250363646930303303655117130679215001348079718769377883175587891712658159138865838853754566357286536534255375081595523334202184019050942693376")]
        [DataRow("216", "169", "33318385174179304227840108991444688989805609978954686745347054636317997334395315993330458486028530675713250021739257132304979638183837257788234495478785964850228569039870897133616343185100770928357981661622037858234724694423163366919647321410510324735758107492233232311387298695753412484722154960695991058189750348529529933327711517205368231953752194968389637859867271487616448785230246692519936")]
        [DataRow("10", "162", "1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")]
        [DataRow("1907", "1579", "47178520737395400861647019745692523679306476099037030802848315759733292097855250484539374839176328392598765330559308611945402505618346620627226876747626131684206984168322427197613393001654188599774645612298871029272571683968727342386097431633345134646751748413719331599963492402098765913704297158468523440649710149509592765834802288234606264716466997937802721512331086938119344639651166888528767271325875676978741583639204019280948276731128064922451164870988890765062657783054629039854038587104324173109256393180624438819400982345966315846809739162850748875207058338058540858637948851224818258385039764574128089147449253865523684577110213937961248181582141061623917325750359031402706979324836423366474836599409405014902276587881929046332074209584326560868144007269571941501875116947161045121238217203701975026320905078275378478909117630166982968010926179638588105990770724856917985210506095545647496816328261469145746883973241771161160127491976974020578204998965628104822908742348209193860572056416836943451858047108231343318784900624807665101585246331018164365775400482386933261950997446110863016246149858048949297652193513667238456149841579288158633357147793722122561418347981537258109051833290717221508361121367996886025827098985748574867800186481483499881376144586777621246483227643620745595347105473900368961335443763465083880442859998188223418989922755234346076392532573457449301378682508294487383704829778530768576675890794250569409129512853966550376375569100996461477778990686015236206593363576647765408318960432149991310800546210007394640782524648061056035288267932179125438048214727363946164484855315575330149257455760917477170555602609318748293558605760571273020248598877200860863421259818903591981728667306387145653162166613590823500723184504496483209141318885993727769781374526130084629310239823760486369014928537434973466177290286303103228737185786576842590934628259449787191303874457243890405175689511260813264994134367394316452418575790636498985906238763155322627117112036033754274993847080428942317089489239049816564360718252487965639389245633791653737276434677156329627184979312768358537395005509491839403276528786757655129057227732532884750217260379313693760496078417327855150531795422819619737555416076585325334313795814247564837828853769081086241448918845754208024121735155341950754434421910487378003414885414888665143207762902659097157589827036644678760098010536765762768863688632453758847066048408036935877137341673692719552806778955162902768463724052706164816105551926664363519500747715430277436197040676772238967820244070683697963694643229037052294196519870214907217517930496643497756994664403976331571350257491969269214962668322863131664462450934528839738688767781640392621162257187611331053281240721770344756986899493306292996952917884156159829896640295612562218140217722938142956372839179896169611713732883723121515010948567506347233592416291776134563624740869677326796632252718019921561252553805733805940762563312442482845829155110004305206704163084841949953997831689847746307542540805483273613713880969818094033355052319329113460318337600436546901983861528012383032033661500454554434275462657638319913885157009027117735849105878633422081875508343578965245056547651234063127575587036962743435998431618365299242701175166844052334311053160522460250570398824295124941856277034300540048309573850659044023655249496574773887711551483921187662740611901487550208588898499165240351403186415526718241542693820693021252737806976796515915384094596893578295533665696619328652466577051020116392265691544100197530140061601055445684367851465692619581829506802014181429165549933481969197504502899740867653506630950321605114436138623282328426670342799293813920434087072787615896707064435359336048725573812403989686219275080502962411191977814475612928310968272842450628152075663079908748844253632383772848358270221131113126227520633500604782947958873518150243141640866344279199169431359063988638809506613916717626284108566954648589802921080836045472366847648963413741466727051812167182144946177982348444832903006255626966323551321412084354920574189184698472697558572657236779478117307279664733781319317931838279553651960048505177933055331443659151068469919552875176487265844271038049795605761326818041091070793479017742531786259353634822545267539375731786183453809508039309348996224484735006506633427202205532193187927274371449497738686814047573613432813791623332125344362733810987146076595081555879389739898055097736546691688787866674713333151998377353351322624952222921624409282672539824049157960989912564878406196189522854159369421964696213658936634192870890398618009899084794760409259079913477396675124521260880973201137717262248855655187802701236467428711089320464579079323305900091766137808894561768233620610567762920292892492608300934904894403474988065648096563226329015746622577529837136116010144204092778391386787807617490335206084051269700042458345870568861980606989441787844477708651256176510856002267912007455124148575465024654657569223168873243018437489607618712596097652962257954481234613747317874811796301725400198155387881009393657812579423238944790873856334558816459779702324368729387671665379816204997197309618896441829666654383509224710012908470436043")]
        [DataRow("3929", "3513", "516139641554026165071853646371635224205930288453166928035373128778264904553133792369704564585570021280170427808268660333030887337318919353287186733055916022523181373583520926191879125397706804642551515290154259596692288888263177036914126157087386907868763682707607219401925077106518579276501469194372975721243417681170880869969260313441754410754624504410537805171271153689811038993687268568283549478710077049303782702081672763327547422830232925421772845218484817558127459242510490112248325711512001018766198104466440421675809704999111792812836823163300602793831608888528061266995467646327436409507524724237531771201956305193101516973956295241554393912599070133852027578809974766408654497897535805909881517042619476785085781503929631579199405577737797584852451490460051187152013177345976865304450664372382100946071987235221765694588748320879809907395602572921714361782181563981608099561055879151653721197672712150609721878580728811044845602335729099704329908518699135847589684451789695457683589326446139256796471763322127053155374212830181131786282782410647571268351196782664295445049469650975117076081176880972882898495373806772576752714672491035304202651297181792577976591502425890764187383153164636254923364667061990314226942851288720226779120667117605926910524368799940632088047009376891851403937257794735912035115552446477865205010685414114732812051758849142505175535842382927687207355504059411048175825108279315161830310643191211746833989746424533242355159052674911474815628533745309512255686173561455771609426005655775577411541480053596630247924870608260528190161016087910693859857881663449067947307808922798220070634378484616308539663975023533367646481497002413106153171049036457202457129406326277182533509880093633313799769461989942984693306505811604792595735900969735843378413809573214310803944228255791785133757394104294520700226066924293667149369354354043777884499397961829352120833166476765234498686883611627728761027389312974995110837780237215934533147108458565472159915807624475068423030140628922716356167975297456596550194738686022774432024342953464434951142466240444170551086302197985367396986264716976604201073151137578543929303267997844802840316414663142645907848336819030311486559641358331393298798668718056069303129068046243736771021073867852671657810044705968250468199690025613907700102880783704321858643061912243240130689075807800533205906235499576642509247366040582645445957482833628287669090418666877105600546758520594867488298177498373970779919781388293260958716856857406473667363264289316659838041316804026162593920262480386378925227542243583529258471444686755561684849043484499547811976956307770136546716047222285725547716863357415839583281822968535662496615307002926910558966583501915875547329280295462456915196079660911290663019399494452800437533720650384518252364769207314492039917697771692628684144616952873295771545233656304292263996078668854237952274031412160799270571019788190155887788698982747478801996513759875843333414567271387316555004177234305397516728384928604656525786998528885071421642015298658183559688449736880952700905696869430732263569020923152342735386409477271007317574067662835926572095280995050207449001422967727211801060983163093126360296892243542587303610718626396458834538931200180377752409054597975480176972041155055441718185123701257626570147632881820174516380118487230365536135522241201413136516857293145544210020489827849013356452889209237752038298914331671072094958602225305176460146423619140234966181408875372907917853413098270047489722649903676053806606339879271332448843090580645925275618923093588350122038997378302793302126163492533148413939993114190259028153098212815528834238065065761769251692174344560021174962000851298816088795682197454207133207412151288360554471832154950652903333152982017497075253153941624778478913272003547648441294164691832594848081253225551379912806318276533031337437142460282562316859170797675202728021742294056879707229589179997889138536594014485500638119383943487618620444298165774409863137445514544782582127950210886491316600076428379878373511000809401957969924621868917927903203801444748253668557475873587069699470512621485195688770777549668487624495637153275713104168741004608451072221552584193693527570291362355424604081076833922461434144586207907713613085920066322251682408083882868689691441632960583300028478104378574579403275550160137231817574560846615107307087104562864979318873315961460899871907556467419381355621421312860404577197976088557610107738111897610400620398269159858233405932773215742533692799595507384853368462296127192668058298147457825340000743328605883793621944515695203901366313224339059459824111584765795441389734713416706829572812470049661765142253367983045562960867294512407334406497378621355721302522928266494799479443697417335410483296662938218928418139354579671523641136941649191289481846180503705392295969427348225452515973019394870872464696446613815664627752487879070941233739918694847045359167714587772818031304371743462009665563076431052330006607801400943266027106084926017641560510024680301922108276252775042347107948205005138248307179678966391951686005022164350288486685688485860128258678814090917847353037716863876981492431786600024894282937938520515322931318581306890505336381716502454598450071710200181130709259785082900507763717903921963444232345895897923744354207096913284463578320660866954820672463498888429755385091106570738858621016473178225689421539233126822274306667246852072119477478714219711028943332852738517086261023556452592485757010281154946796990397510778658566131678437422824662508988882996506429059012087522396887709379191456209501391940856657539802606627964609627137776713575403172055060744292786609565476358376438953144682036984250609100244009887707541013995839719599304246343111667634045275618194938538986254111176292582300761189580965495268220345839666550178368557933679958294801402000671841428471494449334377542447869674743371871499316339422418348293281457478633010222565878915510262983218116439760014342810362809367683409633354763740394869091360896922458278615323988239004978826728302886110609731017083525366095599788970099433043368092916213338732330566889172605819363960107547486121012319464024897461166372651863082500485662972642945391691619574895116240781951788772114706414270538059313484037456039391598145897535121781831790559902448408709943829271008107384449769837957899488893360926482815729000086203351444261029369739179315621468691570219232054051507173066328548913914049853713539013610527592004883211552268784779855669832942319911825830009206379770153435720120249774809282492088007265718916371700718274650700296252247092130088433467964420642944753094566261075565778742330491080560534820909082533273070758840768421460605833440790280747571694770481486861843694821646874418125250039316910061361172314310948354579103350927535802465987584631569259670638425052718678437405245709645324500151213609539105923651233504114739002818503939020375782806519481304332840220623569992901727298338793482443764676246218067259611369434877733226045164498959290131398191272269938129901543263640093255014082421404680277550422232408011712097135363130798365218989731200296768692456738592226804733568632631910683502631804714007415564242052310351258172563493427640038160136327520846812283253917070562568591859296715083283013268137771960787560218500294273966346482812743504136386164183424298186395668798927270260641874987136167322058115558251394835067045325490206357892484555315261565032348008346973848747969367612819711276587064370426709729314753041730072388132079057662400956486415520099559075729901074219236338576837494228584652545576606814863120977678334424955994330005163746576404939994044372499089497297972802129088999755925572363772392791612447449250728307615744085517807130917632563432406832241500401131899355282716240961354547056049675124317331566507740657139103731704937475715851271204872054282784358091411990561242099615535094472046437968193341095689851880217664383515999566299490820887547673182979900375179260841429645345648889342775337235633759230595550870978707166486249826063466947908824269729419458985288115970678692708363918088903042027003837102498585469625077380983190355325674315022091505930473814392269170901691018727651485549696806651862341501122606194229561823925760491201111983655163149625257032611354542794280743084536364680113633083220592957978271881191486339687903592339777162429211739134923802109353165860059405472469088205392001968874424886242380901406683408995491705928042773255306893718501403001330421854532452333293364242514716354141477217205538688832794229024454528889293404930032906952055697181672721196430029622304422639252623725407333103988802048327587297276280762109932445778178331228395489949073621270906204385455516314064866768916462669891174182860187721183631510919130437057376066956182314624988986806396981771560598488841792517913849192375860510621687166606280672662826341645484415928826995258480252088225869216467758298676115836053842435260951695286116111927583652929033400295427895838501791915939409622170498963274212319328615179814001424057479926187545076431329442670117563655650536838526562235505874977588347948969333280487117758059934655201819456511898924158484524848684042004024532060125863698061125967018372654002961882847910218207741603002166644501303947983325473969542354564301151325114573519213606427507673986480142965100730165924094601134047721946175719405274932434101750842398597840582931295783205106726426313258006277379731355734183920100416839465317110929986209986961752426796438285081395391271048781942247674727777890197837882475276385015877351451409339628849499418437221414564331236536324647997220024043534451102581275668114985941114426536777593487335592059054630179676889385453095125742098688595995426815265597086469849507345882483335523507995912459291832236956295434636745513446980057422704622373518318131489683643726032977631638910756257383931381454016819730654855034642759398725076163005867490915158795431058127826366518521166772164775737557415650763837684768562564420240097772269253834072137283022295962471648222154440162598221121103895857381130025730877370323881797562817160727796827644614012029300256105342995582124894136213781098766288836374644820399254349187717861784931900901975912927999091159659673462977643165094612988988949399960013078770173895136837047799379569365697249215410013247478904666392618444734151677240488420548937852237223882598367908465995249684675224620022098953888188147500656982700600917992584362820527071817434515048025817826964405475024870477988573143823480503375698561063865214152375533492295487582837378882465438185358450075959666097126927850316639354477475863734520109989947747109505359110221234568880544263937750155515108682812147870270323730388035738199363184418586722719795622521501263724325262395858398026790034256091967893450293241158969756226045534197128762416503971318524906950238192959018181326603618974719287930545213462099886425750669928153677450029930477677096577535483949147710792734797657002305197842901242492406323692123264367813110240482980545614299796831638996269754772551102410813121741218038135714162854199181602909751500457164308945005170674029918783774305639957628337440896064147536231327581819250874082184270237511600761847776006126002671502101855413841630343822991116609258482510605473954517399698111722634712146157042393416089968175661410311264092146845501253967674228294226521201427240859260029156039823548450706682070528630873684262095508504608967959395731937598030435591212463112979765555749364717269733404735459443496549833629241070095688079865964154651217305960051271249846747780347242873124280832939608936561649177367412662133926251831055563903494804839598271051800050674585582838272444728067675763885857012896049366018540275621796705511333269269784303177494152647332007471084331654563519125139465397200985143267471592085390877633338424595464168575924627560466748464775492434555924786178091739755922417950697615662157232673921913127198518969004206775762488141788155819839431033099355719559023049739622231731781306916889504390861685117244675293873547611020793122862509679923689742515792327914899098731146902699858150256560166108690232423561069532788218862233674614949541929948043918918267532594277962499634789423073761164274571780112542044350707625396005390411104595539645219562805150996113314092028850449057192863348415822785314285141147908411963971316675958115267260748342371902304777179039804951697693608108863425683358212163499203742405675991180121669102315078031358897042096372167465027851049206688198094057174325956714077726239632603686413057143141516797452711841723434756523879075867496084532461475272511626130064418079810533497911729831144471626883003154780565884863380889")]
        public void NthRootSpecifiedTest(string expectedBasement, string inputExponent, string inputSource)
        {
            var source = BigInteger.Parse(inputSource);
            var exponent = int.Parse(inputExponent);
            var actualBasement = source.NthRoot(exponent, true);
            Assert.AreEqual(expectedBasement ?? "", actualBasement?.ToString() ?? "");
        }

        [TestMethod]
        [DataRow(@"Data\Speed\00*.txt")]
        [DataRow(@"Data\Speed\01*.txt")]
        [DataRow(@"Data\Speed\02*.txt")]
        [DataRow(@"Data\Speed\03*.txt")]
        [DataRow(@"Data\Speed\04*.txt")]
        [DataRow(@"Data\Speed\05*.txt")]
        [DataRow(@"Data\Speed\06*.txt")]
        [DataRow(@"Data\Speed\07*.txt")]
        [DataRow(@"Data\Speed\08*.txt")]
        [DataRow(@"Data\Speed\09*.txt")]
        [DataRow(@"Data\Speed\10*.txt")]
        [DataRow(@"Data\Speed\11*.txt")]
        [DataRow(@"Data\Speed\12*.txt")]
        [DataRow(@"Data\Speed\13*.txt")]
        [DataRow(@"Data\Speed\14*.txt")]
        [DataRow(@"Data\Speed\15*.txt")]
        [DataRow(@"Data\Speed\16*.txt")]
        [DataRow(@"Data\Speed\17*.txt")]
        [DataRow(@"Data\Speed\18*.txt")]
        [DataRow(@"Data\Speed\19*.txt")]
        [DataRow(@"Data\Speed\20*.txt")]
        [DataRow(@"Data\Speed\21*.txt")]
        [DataRow(@"Data\Speed\22*.txt")]
        [DataRow(@"Data\Speed\23*.txt")]
        public void NthRootSpeedTest(string filePathTemplate)
        {
            for (var k = 0; k < 10; ++k)
            {
                var filePath = filePathTemplate.Replace("*", k.ToString());
                var json = File.ReadAllText(filePath);
                var dataSet = JsonConvert.DeserializeObject<DataSet>(json);

                var expectedBasement = BigInteger.Parse(dataSet.Basement);
                var exponent = int.Parse(dataSet.Exponent);
                var power = BigInteger.Parse(dataSet.Power);

                var actualBasement = power.NthRoot(exponent, true);
                Assert.AreEqual(expectedBasement.ToString() ?? "", actualBasement?.ToString() ?? "");
            }
        }
    }
}